<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>AusDigital Notary (NRY) 1.0 Specification - AusDigital Standards by ausdigital</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>

<body>

<header class="header">
    <div class="header-line">
        <div class="wrapper">
            <div id="mobile-menu-wrapper" class="mobile-menu">
                <button id="hamburger-menu" class="hamburger-menu">
                    <span>toggle menu</span>
                </button>
                <div id="mobile-menu" style="display: none;">
                    
                    <ul class="sidebar-menu">
    
    <li class="menu-title">Benefits</li>
    <li><a  href="/business-case/">A Business Case</a></li>
    <li class="menu-title">Technical Specs</li>
    <li><a  href="/ausdigital-idp/">Identity Provider (IDP)</a></li>
    <li><a  href="/ausdigital-dcl/">Capability Locator (DCL)</a></li>
    <li><a  href="/ausdigital-dcp/">Capability Publisher (DCP)</a></li>
    <li><a  href="/ausdigital-tap/">Access Point (TAP)</a></li>
    <li><a  href="/ausdigital-tap-gw/">TAP Gateway (TAP-GW)</a></li>
    <li><a  href="/ausdigital-nry/">Notary (NRY)</a></li>
    <li><a  href="/ausdigital-syn/">UBL Syntax (SYN)</a></li>
    <li class="menu-title">Semantic Specs</li>
    <li><a  href="/ausdigital-code/">Code Lists Mgmt (CODE)</a></li>
    <li><a  href="/ausdigital-bill/">Billing Process (BILL)</a></li>
    <li><a  href="/ausdigital-po/">Purchase Orders (PO)</a></li>
    <li><a  href="/ausdigital-ship/">Fulfillment (SHIP)</a></li>
    <li class="menu-title">Governance</li>
    <li><a  href="/governance-model/">Governance Model</a></li>
    <li class="menu-title">Community</li>
    <li><a href="http://eepurl.com/ctZ6hf" target="_blank">Newsletter (subscribe)</a></li>
    <li><a href="http://chat.ausdigital.org" target="_blank">Chat (join team)</a></li>
    <li><a href="https://github.com/ausdigital/" target="_blank">GitHub</a></li>
</ul>

                </div>
            </div>
            <a href="/" class="logo"><img src="/images/logo.png" alt="AusDigital"><span>AusDigital.org</span></a>
            <div class="header-search">
                <script>
                    (function() {
                        var cx = '017892665596304004128:tj19kxwel_m';
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                    })();
                </script>
                <gcse:search></gcse:search>
            </div>
            
        </div>
    </div>
    <div class="header-content">
        <div class="wrapper">
            <img src="/images/logo.png" alt="AusDigital">
            <div class="header-text-box">
                <div class="header-name">AusDigital Standards</div>
                <div class="header-tagline">Business to Business data exchange open standards community </div>
            </div>
        </div>
    </div>
</header>
<script type="text/javascript">
    document.getElementById('hamburger-menu').onclick = function() {
        var nf = document.getElementById('mobile-menu');

        // Show and hide menu items when toggle is clicked
        if(nf.style.display==='none') {
            nf.style.display = 'block';
        }
        else {
            nf.style.display = 'none';
        }
    };

    window.addEventListener('click', function(e){
        if (!document.getElementById('mobile-menu-wrapper').contains(e.target)){
            document.getElementById('mobile-menu').style.display= 'none';
        }
    });
</script>

<div class="main-wrapper">
    <div class="main-content">
        <div class="page-sidebar">
            <ul class="sidebar-menu">
    
    <li class="menu-title">Benefits</li>
    <li><a  href="/business-case/">A Business Case</a></li>
    <li class="menu-title">Technical Specs</li>
    <li><a  href="/ausdigital-idp/">Identity Provider (IDP)</a></li>
    <li><a  href="/ausdigital-dcl/">Capability Locator (DCL)</a></li>
    <li><a  href="/ausdigital-dcp/">Capability Publisher (DCP)</a></li>
    <li><a  href="/ausdigital-tap/">Access Point (TAP)</a></li>
    <li><a  href="/ausdigital-tap-gw/">TAP Gateway (TAP-GW)</a></li>
    <li><a  href="/ausdigital-nry/">Notary (NRY)</a></li>
    <li><a  href="/ausdigital-syn/">UBL Syntax (SYN)</a></li>
    <li class="menu-title">Semantic Specs</li>
    <li><a  href="/ausdigital-code/">Code Lists Mgmt (CODE)</a></li>
    <li><a  href="/ausdigital-bill/">Billing Process (BILL)</a></li>
    <li><a  href="/ausdigital-po/">Purchase Orders (PO)</a></li>
    <li><a  href="/ausdigital-ship/">Fulfillment (SHIP)</a></li>
    <li class="menu-title">Governance</li>
    <li><a  href="/governance-model/">Governance Model</a></li>
    <li class="menu-title">Community</li>
    <li><a href="http://eepurl.com/ctZ6hf" target="_blank">Newsletter (subscribe)</a></li>
    <li><a href="http://chat.ausdigital.org" target="_blank">Chat (join team)</a></li>
    <li><a href="https://github.com/ausdigital/" target="_blank">GitHub</a></li>
</ul>

        </div>
        <div class="page-content docs-content">
            <div class="spec-header">
                
                <ul>
                    <li>Spec ID: <p>ausdigital-nry/1</p>
</li>
                    <li><p><img src="http://rfc.unprotocols.org/spec:2/COSS/raw.svg" alt="raw" /></p>
</li>
                    <li>Editor: <p><a href="mailto:christopher.d.gough@gmail.com">Chris Gough</a></p>
</li>
                    <li>Contributors: 
</li>
                </ul>
            </div>
            <div class="specs-toc">
    <!--<div class="specs-toc-title">Table of contents</div>-->
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h2"><a href="#goals">Goals</a></li>
<li class="toc-entry toc-h2"><a href="#status">Status</a></li>
<li class="toc-entry toc-h2"><a href="#glossary">Glossary</a></li>
<li class="toc-entry toc-h2"><a href="#licence">Licence</a></li>
<li class="toc-entry toc-h2"><a href="#change-process">Change Process</a></li>
<li class="toc-entry toc-h2"><a href="#language">Language</a></li>
<li class="toc-entry toc-h1"><a href="#application-programming-interface">Application Programming Interface</a></li>
<li class="toc-entry toc-h2"><a href="#post-object-to-notary">POST object to Notary</a></li>
<li class="toc-entry toc-h2"><a href="#search-notary-archives">Search Notary Archives</a></li>
<li class="toc-entry toc-h2"><a href="#access-notarised-objects">Access Notarised Objects</a></li>
<li class="toc-entry toc-h1"><a href="#blockchain-gazettal">Blockchain Gazettal</a></li>
<li class="toc-entry toc-h2"><a href="#hoc-proof">HOC Proof</a></li>
<li class="toc-entry toc-h3"><a href="#validating-hoc-proof">Validating HOC Proof</a></li>
<li class="toc-entry toc-h2"><a href="#hoc-header">HOC Header</a></li>
<li class="toc-entry toc-h3"><a href="#validating-hoc-header">Validating HOC Header</a></li>
<li class="toc-entry toc-h3"><a href="#notary-reputation">Notary Reputation</a></li>
<li class="toc-entry toc-h2"><a href="#hoc-detail">HOC Detail</a></li>
</ul>
</div>
            <h2 id="introduction">Introduction</h2>

<p>This document describes the Notary (NRY) specification, which provides an irrefutable
history of a specific “contract” (e.g. an invoice and it’s status lifecycle), pegged to
a blockchain distributed ledger. This service supports dispute resolution and provides
the foundation platform for financial services such as debtor financing. Notarisation
also makes it possible for the business system to audit the reliability of any TAP
Gateway that it uses.</p>

<h2 id="goals">Goals</h2>

<p>Facilitate features in the TAP protocol that:</p>

<ul>
  <li>Prevent post-hoc “Fraud of Commission” (retrospective creation of false document history).</li>
  <li>Prevent post-hoc “Fraud of Omission” (surreptitious destruction of legitimate document history).</li>
</ul>

<p>Balance information security with utility:</p>

<ul>
  <li>Sufficient public data for transaction stakeholders to independently verify integrity of shared-secret documents.</li>
  <li>Information from private documents is not leaked into the public domain, even in a future where tools exist to overcome contemporary cryptographic methods.</li>
  <li>Ensure notarised object sources are identified (to a known and meaningful level of identity assurance), but do not leak information about subjects that could be used to analyse communication or transaction traffic.</li>
  <li>Publically auditable (transparent), to enable notary reputation to be based on independent performance evaluation using transparent, non-repudiable and objective data. In addition to the relevant data being open, the cost of monitoring and verifying the activities of a notary must not be prohibitive.</li>
</ul>

<p>Sustainable and secure infrastructure:</p>

<ul>
  <li>Socially responsible, blockchain-efficient public storage of existence proofs. This means low externalised community cost (impact on the shared ledger) even if a very large number of objects are notarised in a given time frame.</li>
  <li>Leverage the strongest consensus product available (maximise resistance to Sybl attacks).</li>
  <li>Leverage the most efficient proof market available (minimise cost of proof at the given consensus-strength).</li>
  <li>Avoid single point of failure in the network that stores and distributes existence proof.</li>
</ul>

<p>These are achieved by:</p>

<ul>
  <li>Notarising all objects (in a timeframe) into a proscribed Merkle-DAG data structure that is pegged to the Blockchain with a single record, which references a minimal signed proof document that can be verified before accessing a significant data volumes.</li>
  <li>Distributing the pegged Merkle-DAG proof structure with a decentralised, content-addressable memory system (modelled on and compatible with the Inter Planetary File System, IPFS).</li>
  <li>Avoid proprietary blockchains. Adopt the largest public blockchain with the highest market capitalisation (BitCoin), thereby sourcing work-proof from an open market of commodity mining services and multiple open source softwares implementations.</li>
</ul>

<h2 id="status">Status</h2>

<p>This spec is an early draft for consultation.</p>

<p>This specification aims to support the Australian Digital Business Council
<a href="http://ausdigital.org">eInvoicing initiative</a>, and is under active
development at
<a href="https://github.com/ausdigital/notary">https://github.com/ausdigital/ausdigital-nry</a>.</p>

<p>Comments and feedback are encouraged and welcome. Pull requests with improvements are welcome too.</p>

<h2 id="glossary">Glossary</h2>

<table>
  <thead>
    <tr>
      <th>Phrase</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ausdigital-nry/1</td>
      <td>This specification.</td>
    </tr>
    <tr>
      <td>ausdigital-dcl/1</td>
      <td>Version 1 of the <a href="http://ausdigital.org">AusDigital</a> <a href="http://ausdigital.org/specs/ausdigital-dcl/1.0">Digital Capability Lookup (DCL)</a> specification</td>
    </tr>
    <tr>
      <td>ausdigital-dcp/1</td>
      <td>Version 1 of the AusDigital <a href="http://ausdigital.org/specs/ausdigital-dcp/1.0">Digital Capability Provider (DCP)</a> specification</td>
    </tr>
    <tr>
      <td>ausdigital-idp/1</td>
      <td>Version 1 of the AusDigital <a href="http://ausdigital.org/specs/ausdigital-idp/1.0">Identity Provider (IDP)</a> specification.</td>
    </tr>
    <tr>
      <td>ausdigital-tap/1</td>
      <td>Version 1 of the AusDigital <a href="http://ausdigital.org/ausdigital-tap">Transaction Access Point(TAP)</a> specification.</td>
    </tr>
  </tbody>
</table>

<p>This service depends on <code class="highlighter-rouge">ausdigital-dcl/1</code>, <code class="highlighter-rouge">ausdigital-dcp/1</code> and <code class="highlighter-rouge">ausdigital-idp/1</code>.</p>

<p>The <code class="highlighter-rouge">ausdigital-tap</code> specification depends on this document. Note, while this specification describes a generic notary interface, the TAP specification provides further restriction on the use of the notary.</p>

<p><strong>TODO</strong>: add all used terms here</p>

<ul>
  <li>content-address - some address/individual identification token, which depends only on item (file) content and uniquely identifies this item</li>
  <li>Merkle-DAG - tree-like data structure, where top node refers its children by their content-address</li>
  <li>IPFS - InterPlanetary File System - infrastucture to store item with their SHA-256 hashes as top-level content address. If item is a directory then it may contain subdirectories and files with their readable names, but referencing is being performing by content-address anyway.</li>
  <li>QmHash, Ipfs Hash - 46-characters value starting with <code class="highlighter-rouge">Qm</code>, representing the SHA-256 sum of the given item (where item is a file, directory structure or block). Source SHA-256 value encoded by (<strong>TODO</strong>: what does it called, hash to QmStuff?)</li>
  <li>Notary Archive, HOC Archive - directory-like structure with proof.json and proof.sig files</li>
  <li>HOC Header - file/json structure, referenced from proof.json file in HOC Archive by its content-address</li>
  <li>HOC Detail - file/json structure, referenced either from the HOC Header or another HOC Detail (in case of nested HOC Details).</li>
</ul>

<h2 id="licence">Licence</h2>

<p>Copyright (c) 2016 the Editor and Contributors. All rights reserved.</p>

<p>This Specification is free software; you can redistribute it and/or modify it under the
terms of the GNU General Public License as published by the Free Software Foundation;
either version 3 of the License, or (at your option) any later version.</p>

<p>This Specification is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program;
if not, see <a href="http://www.gnu.org/licenses">http://www.gnu.org/licenses</a>.</p>

<h2 id="change-process">Change Process</h2>

<p>This document is governed by the <a href="http://rfc.unprotocols.org/spec:2/COSS/">2/COSS</a> (COSS).</p>

<h2 id="language">Language</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in
RFC 2119.</p>

<h1 id="application-programming-interface">Application Programming Interface</h1>

<p>The notary MUST provide a REST API, which can be used for two purposes:</p>

<ul>
  <li>POST methods that task the notary with notarising a digital record (this may or may not involve storing the object in the notary’s archive).</li>
  <li>GET methods that access notarised data from the notary’s archive (this may or may not require authentication, and may or may not be subject to content-based access control rules)</li>
</ul>

<p>Current API format is described using http://jsonapi.org/ for unification.</p>

<p>Perhaps unsurprisingly, the notary API does not generally furnish any PUT, PATCH or DELETE methods. Notary records are immutable until disposal, which is scheduled at the time of notarisation.</p>

<p>Notary records are additive; the only way to change the parameters of notarisation is to make a subsequent notarisation request with different parameters (the notary will meet obligations of both requests).</p>

<p>The notary API is comprised of two REST/JSON resources, <code class="highlighter-rouge">/public/</code> and <code class="highlighter-rouge">/private/</code>. These work in similar ways, but have different access control rules. Separate endpoints are used (rather than a parameter) to minimise risk of accidentally publishing private objects (“poka-yolk” principle).</p>

<p>Implementations MAY allow users to restrict client access to one or the other endpoint on a per-JWT Token basis.</p>

<table>
  <thead>
    <tr>
      <th>Verb</th>
      <th>/public/*</th>
      <th>/private/*</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>no token required</td>
      <td>token + ACL</td>
    </tr>
    <tr>
      <td>POST</td>
      <td>token + ACL</td>
      <td>token + ACL</td>
    </tr>
    <tr>
      <td>PUT</td>
      <td>generally not available</td>
      <td>generally not available</td>
    </tr>
    <tr>
      <td>PATCH</td>
      <td>generally not available</td>
      <td>generally not available</td>
    </tr>
    <tr>
      <td>DELETE</td>
      <td>generally not available</td>
      <td>generally not available</td>
    </tr>
  </tbody>
</table>

<p>The Notary API is a REST/JSON protocol, layered on HTTP. Implementations:</p>

<ul>
  <li>MUST use HTTPS (RFC2818).</li>
  <li>MUST use Content-Type: multipart/form-data (RFC2388)</li>
  <li>MUST NOT use Content-Type: application/x-www-form-urlencode (RFC1876 is NOT supported)</li>
  <li>MAY explicitly declare Content-Transfer-Encoding: base64</li>
  <li>MUST NOT rely on notary semantic information in HTTP headers</li>
</ul>

<h2 id="post-object-to-notary">POST object to Notary</h2>

<p>The POST verb is used to request notarisation. The posted body encoded as <code class="highlighter-rouge">multipart/form-data</code> and contains two parts, <code class="highlighter-rouge">object</code> and <code class="highlighter-rouge">parameters</code>. Optionally object content-type and filename may be provided, which is helpful for downloading objects from notarizer.</p>

<p>Posting an object to the <code class="highlighter-rouge">/public/</code> or <code class="highlighter-rouge">/private/</code> notary resource causes the notary business to incur cost and obligation. The notary may refuse, or may agree under commercial terms. For this reason, POST requests always must be authenticated with a JWT header issued under the <code class="highlighter-rouge">ausdigital-idp/1</code> specification.</p>

<p>Assuming the current working directory contains the object (as <code class="highlighter-rouge">object.foo</code>) and parameters (as <code class="highlighter-rouge">param.json</code>), the following curl command will post the message to the notary endpoint:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>curl -X POST <span class="se">\</span>
 -H <span class="s2">"Content-Type: multipart/form-data"</span> <span class="se">\</span>
 -H <span class="s2">"Authorization: Bearer &lt;API_TOKEN&gt;"</span> <span class="se">\</span>
 -F <span class="s2">"object=@object.foo"</span> <span class="se">\</span>
 -F <span class="s2">"parameters=@param.json"</span> <span class="se">\</span>
 &lt;NRY_URL&gt;
</code></pre>
</div>

<p>(Replace <NRY_URL> with HTTPS URL discovered from the Digital Capability Publisher of the business providing the Notary Service, and replace <API_TOKEN> with the JWT issued by the `ausdigital-idp/1` Identity Provider).</API_TOKEN></NRY_URL></p>

<p>The protocol places no physical restriction on the <code class="highlighter-rouge">object.foo</code> POSTed to the notary API, however there may be some practical limits from the underlying HTTP infrastructure. For example, there may be some limit to the maximum file size than can be reliably POSTed. Please consult implementation-specific limits of the target notarizer installation.</p>

<p>The <code class="highlighter-rouge">param.json</code> file:</p>

<ul>
  <li>MUST be a JSON file that is valid per <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/nry_post_param.schema"><code class="highlighter-rouge">nry_post_param.schema</code></a> JSON schema.</li>
  <li>MUST contain a <code class="highlighter-rouge">durability</code> attribute that is an ISO 8601 formatted datetime string with timezone</li>
  <li>The <code class="highlighter-rouge">durability</code> date MUST be not less than one month in the future</li>
  <li>MUST contain a <code class="highlighter-rouge">network</code> attribute that is a valid business identifier URN per <code class="highlighter-rouge">ausdigital-dcp/1</code> specification.</li>
  <li>MUST contain an <code class="highlighter-rouge">ac_code</code> attribute, that is a non-negative integer for the given specification.</li>
  <li>If the <code class="highlighter-rouge">network</code> value is a business identifier of the notary itself, then the <code class="highlighter-rouge">ac_code</code> MUST be interpreted per <code class="highlighter-rouge">ausdigital-nry/1</code>.</li>
  <li>If the <code class="highlighter-rouge">network</code> value is not a business identifier of the notary:
    <ul>
      <li>the <code class="highlighter-rouge">ac_code</code> MAY be interpreted as <code class="highlighter-rouge">ac_code</code> = 3.</li>
      <li>the notary MAY silently fail to store the notarised object.</li>
      <li>the Notary API resource must be <code class="highlighter-rouge">/private/</code> (alternate <code class="highlighter-rouge">network</code>s MUST NOT be used with the <code class="highlighter-rouge">/public/</code> resource).</li>
    </ul>
  </li>
  <li>For given <code class="highlighter-rouge">ac_code</code> object <code class="highlighter-rouge">private</code> or <code class="highlighter-rouge">public</code> namespace must be equal to described in ac_code table in “HOC Header” section.</li>
</ul>

<p>For <code class="highlighter-rouge">ac_code == 0</code> (public document, public hoc_details):</p>

<ul>
  <li><code class="highlighter-rouge">restrict_list</code> parameter MUST NOT be provided (because it’s pointless)</li>
</ul>

<p>For <code class="highlighter-rouge">ac_code != 0</code>:</p>

<ul>
  <li><code class="highlighter-rouge">restrict_list</code> parameter is required</li>
  <li><code class="highlighter-rouge">restrict_list</code> contains list of participant identifiers (which MAY be empty)</li>
  <li>user MAY include himself to <code class="highlighter-rouge">restrict_list</code> to be able to access this document</li>
</ul>

<p>For <code class="highlighter-rouge">ac_code == 1</code> or <code class="highlighter-rouge">3</code> (private document):</p>

<ul>
  <li><code class="highlighter-rouge">ac_code != 0</code> rules applied</li>
  <li><code class="highlighter-rouge">restrict_list</code> MUST be provided</li>
  <li><code class="highlighter-rouge">restrict_list</code> participants can access this notarized document</li>
</ul>

<p>For <code class="highlighter-rouge">ac_code == 2</code> or <code class="highlighter-rouge">3</code> (private HocDetil):</p>

<ul>
  <li><code class="highlighter-rouge">ac_code != 0</code> rules applied</li>
  <li><code class="highlighter-rouge">restrict_list</code> MUST be provided</li>
  <li><code class="highlighter-rouge">restrict_list</code> contains list of participant identifiers which can access this HocDetail</li>
  <li>HocDetail final <code class="highlighter-rouge">restrict_list</code> consists of all participant identifiers from all <code class="highlighter-rouge">restrict_list</code> from all documents and nested HocDetails.</li>
  <li>if HocDetail is private and notarized document is public then document <code class="highlighter-rouge">restrict_list</code> used only to limit HocDetail access, notarized document is still public and can be accessed by anyone without any authentication.</li>
</ul>

<p>Note: if object is private and <code class="highlighter-rouge">restrict_list</code> is empty (even document owner not included) then even initial document sender can’t access this document, which makes it useful for some circumstances. Implementations MAY issue warning in this case. Initial user MAY post document again with different restricted_list or make it available elsewhere.</p>

<p>When the notary receives a valid notarisation request, if it doesn’t refuse the request and doesn’t experience technical difficulties, then it MUST:</p>

<ul>
  <li>place notarised object in a system of record (unless the <code class="highlighter-rouge">param.json</code> <code class="highlighter-rouge">network</code> value is not a business identifier of the notary, in which case the notary MAY place the notarised object in a system of record)</li>
  <li>reference API Spec (return HTTP 201 CREATED response code, headers, etc)</li>
  <li>return HTTP body that is JSON document that is valid per <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/nry_post_response.schema"><code class="highlighter-rouge">nry_post_response.schema</code></a> JSON schema.</li>
  <li>The body must contain a <code class="highlighter-rouge">doc_id</code> attribute containing a verifiable content-address of the notarised object, using a hash and encoding scheme that is a valid IPFS address.</li>
</ul>

<p>When the notary receives an invalid notarisation request, or if it receives a valid request that it choses to refuse, or if it experiences technical difficulties, then it:</p>

<ul>
  <li>MUST return an appropriate HTTP response code (4xx or 5xx, see swagger specification)</li>
  <li>The body MUST NOT contain a <code class="highlighter-rouge">doc_id</code> attribute</li>
  <li>The body MUST contain jsonapi.org-compliant error response</li>
  <li>extra error information may be provided in the response</li>
</ul>

<p>The <code class="highlighter-rouge">doc_id</code> returned in the body of successful POSTs (HTTP code 201 responses) is a valid content identifier. This <code class="highlighter-rouge">doc_id</code> is subsequently used as notarised object identifier in blockchain Gazettal. It is also the <code class="highlighter-rouge">doc_id</code> used in <code class="highlighter-rouge">GET /public/{doc_id}/</code> and <code class="highlighter-rouge">GET /private/{doc_id}/</code> API calls. Specific <code class="highlighter-rouge">doc_id</code> attribute position on the response specified by jsonapi.org protocol.</p>

<h2 id="search-notary-archives">Search Notary Archives</h2>

<p>There are two search interfaces:</p>

<ul>
  <li><code class="highlighter-rouge">GET /public/?{filter}</code></li>
  <li><code class="highlighter-rouge">GET /private/?{filter}</code></li>
</ul>

<p>Both return a list of <code class="highlighter-rouge">doc_id</code>s that match the <code class="highlighter-rouge"><span class="p">{</span><span class="err">filter</span><span class="p">}</span></code>.</p>

<ul>
  <li>The <code class="highlighter-rouge">GET /private/?{filter}</code> form MUST use an JWT Token issued by an <code class="highlighter-rouge">ausdigital-idp/1</code> Identity Provider.</li>
  <li>The <code class="highlighter-rouge">GET /public/?{filter}</code> form MAY use an JWT Token.</li>
</ul>

<p>The filter may include the following parameters:</p>

<ul>
  <li><code class="highlighter-rouge">restrict_list=&lt;STR&gt;</code>, where <STR> is a comma separated list of URN business identifiers per `ausdigital-dcp/1`
If not supplied the business identifier claim in the JWT Token JWT is used (meaning "restrict to message I am authorised to see")</STR></li>
  <li><code class="highlighter-rouge">submitted_after=&lt;STR&gt;</code>, where <STR> is an ISO 8601 datetime. Only objects after this datetime will be returned.</STR></li>
  <li><code class="highlighter-rouge">submitted_before=&lt;STR&gt;</code></li>
</ul>

<p><code class="highlighter-rouge">restrict_list</code> filter parameter is optional and:</p>

<ul>
  <li>applicable only to private objects</li>
  <li>not applicable to public objects (ignored)</li>
  <li>contains comma-separated list of 1 or more elements</li>
  <li>applied to businesses in the restrict_list POST parameter of the objects</li>
  <li>where multiple URNs are provided, they are combined with logical AND.</li>
</ul>

<h2 id="access-notarised-objects">Access Notarised Objects</h2>

<p>If the <code class="highlighter-rouge">durability</code> datetime of the notarise object is now or in the future:</p>

<ul>
  <li>Any <code class="highlighter-rouge">doc_id</code> listed in the response from a <code class="highlighter-rouge">GET /public/?{filter}</code> query MUST be available with <code class="highlighter-rouge">GET /public/{doc_id}/</code></li>
  <li>Any <code class="highlighter-rouge">doc_id</code> listed in the response from a <code class="highlighter-rouge">GET /private/?{filter}</code> query MUST be available with <code class="highlighter-rouge">GET /private/{doc_id}/</code>, if the same JWT Token is used for both queries.</li>
  <li>The notarised object MAY also be available via IPFS using the ipfs standalone client or any http-ipfs gateway.</li>
</ul>

<p>If the <code class="highlighter-rouge">durability</code> datetime of the notarised object is in the past:</p>

<ul>
  <li>Any <code class="highlighter-rouge">doc_id</code> listed in the response from a <code class="highlighter-rouge">GET /public/?{filter}</code> query MAY be available with <code class="highlighter-rouge">GET /public/{doc_id}/</code>, or it MAY return an HTTP 404 response.</li>
  <li>Any <code class="highlighter-rouge">doc_id</code> listed in the response from a <code class="highlighter-rouge">GET /private/?{filter}</code> query MAY be available with <code class="highlighter-rouge">GET /private/{doc_id}/</code> (if the same JWT Token is used for both queries), or it MAY return an HTTP 404 response.</li>
  <li>The notarised object MAY also be available via IPFS using the ipfs standalone client or any http-ipfs gateway.</li>
</ul>

<h1 id="blockchain-gazettal">Blockchain Gazettal</h1>

<p>Periodically, the Notary:</p>

<ul>
  <li>Generates a Multi-Part Hosting Obligation Contract (Full HOC) describing archived records</li>
  <li>Makes timely public commitment to store and publish archived objects under the terms of the HOC</li>
</ul>

<p>The Full HOC is a four layer Directed Acyclic Graph (DAG) comprised of JSON files, where each layer references the lower layer by cryptographic hash of its contents, making it a “Merkle-DAG” structure.</p>

<p>Each document in this Merkle-DAG has a specific purpose. Some parts of the structure are always public (first two layers, HOC Proof and HOC Header). Other parts may or may not be public depending on the application (HOC Detail and Notarised Object).</p>

<p><img src="./hoc.png" alt="ERD of Merkle-DAG" /></p>

<p>The public parts of the HOC are published in a directory-like structure with a content-address in its path. Two parts have fixed names (<code class="highlighter-rouge">proof.json</code> and <code class="highlighter-rouge">proof.sig</code>), while all the other parts names are consistent with their content-addresses (meaning the file name is equivalent to the IPFS address of the file contents).</p>

<p>Content-addressing is consistent with the IPFS content-addresses format, for example <code class="highlighter-rouge">QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2</code>. Content addresses may refer to individual files or directory-like collections of files (and subdirectories, recursively).</p>

<p>The following examples assume that this address is the address of the directory-like structure that has been gazetted in the blockchain:</p>

<ul>
  <li><code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2</code></li>
</ul>

<h2 id="hoc-proof">HOC Proof</h2>

<p>The HOC Proof is used to validate the Full HOC prior to potentially intensive computation or network activity.</p>

<p>To ensure efficient auditability of notaries, an independent observer should be able to parse the blockchain and extract <code class="highlighter-rouge">OP_RETURN</code> transactions that look like IPFS addresses. For each IPFS address-like record found, the observer should be able to ignore invalid HOCs cheaply. The purpose of the HOC Proof is to provide a compact and verifiable reference to the hoc_head document (which may be less compact).</p>

<ul>
  <li>The Gazetted address MUST contain a HOC Proof, comprised of two files, <code class="highlighter-rouge">proof.json</code> and <code class="highlighter-rouge">proof.sig</code>.</li>
  <li><code class="highlighter-rouge">proof.json</code> MUST be valid per the <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/proof.schema"><code class="highlighter-rouge">proof.schema</code></a> JSON schema specification.</li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a PROTOCOL attribute, which identifies the protocol for processing the Merkle-DAG. The value of the PROTOCOL attribute MUST be <code class="highlighter-rouge">ausdigital-nry/1.0</code>.</li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a SIG_DATE attribute containing an ISO 8601 formatted date and time string identifying when the notary notionally created the <code class="highlighter-rouge">proof.sig</code></li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a NOTARY attribute, which references the business identifier of the notary in URN format consistent with AusDigital DCL and DCP specifications.</li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a <code class="highlighter-rouge">pub_key</code> attribute, which contains a public key (<strong>TODO</strong>: what format? how encoded? gpg2 armor format?)</li>
  <li>The public key in the <code class="highlighter-rouge">pub_key</code> attribute of <code class="highlighter-rouge">proof.json</code> MUST be published in the DCP entry of the NOTARY business, as a valid (not revoked) key on SIG_DATE</li>
  <li><code class="highlighter-rouge">proof.sig</code> MUST be a valid signature of <code class="highlighter-rouge">proof.json</code>, using the public key identified in <code class="highlighter-rouge">proof.json</code></li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a <code class="highlighter-rouge">durability</code> attribute, the value of which is an ISO 8601 formatted date string.</li>
  <li>The <code class="highlighter-rouge">durability</code> date MUST be later than SIG_DATE by no less than one month.</li>
  <li>The NOTARY MUST commit their reputation to the availability of the HOC until the <code class="highlighter-rouge">durability</code> date.</li>
  <li><code class="highlighter-rouge">proof.json</code> MUST contain a hoc_head attribute with a value that is a valid content-address hash.</li>
</ul>

<h3 id="validating-hoc-proof">Validating HOC Proof</h3>

<p>The first step in validating the Merkle-Dag is to check that the proof.json exists and is no larger than MAX_SIZE.</p>

<p>For example, assuming the blockchain contains <code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2</code>, the validation begins with:</p>

<ul>
  <li>test for the existence of <code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2/proof.json</code></li>
  <li>if the proof.json is larger than <code class="highlighter-rouge">MAX_SIZE</code>, it is not valid. There is no need to download more than <code class="highlighter-rouge">MAX_SIZE + 1 byte</code> in this step; technically it requires just several hundreds of bytes to get file size.</li>
  <li>test for the existence of <code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2/proof.sig</code></li>
  <li>if the proof.sig is larger than <code class="highlighter-rouge">MAX_SIZE</code>, it is not valid. There is no need to download more than <code class="highlighter-rouge">MAX_SIZE + 1 byte</code> in this step.</li>
</ul>

<p>If <code class="highlighter-rouge">proof.json</code> and <code class="highlighter-rouge">proof.sig</code> both exist and neither exceed MAX_SIZE, the next step is to ensure that <code class="highlighter-rouge">proof.json</code> validates agains the json schema. Assuming <code class="highlighter-rouge">proof.json</code> and <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/proof.schema"><code class="highlighter-rouge">proof.schema</code></a> are both in the current working directory, the <code class="highlighter-rouge">jsonschema</code> program could be used like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>jsonschema -i proof.json proof.schema
</code></pre>
</div>

<p>If the schema is valid, it will have a <code class="highlighter-rouge">NOTARY</code> element containing the business identifier of the party responsible for notarisation. The value of this attribute is a business identifier which can be resolved via the AusDigital <a href="http://ausdigital.org/specs/ausdigital-dcl/1.0">Digital Capability Lookup</a>, which will yield an AusDigital <a href="http://ausdigital.org/specs/ausdigital-dcp/1.0">Digital Capability Provider</a> where the public keys of that organisation can be discovered.</p>

<p>Note:</p>

<ul>
  <li>Multiple public keys may be associated with a business in the DCP register</li>
  <li>The value of the <code class="highlighter-rouge">pub_key</code> attribute in <code class="highlighter-rouge">proof.json</code> MUST be listed in the DCP entry for the NOTARY</li>
  <li>The DCP listing of the <code class="highlighter-rouge">pub_key</code> signature MUST NOT have a PUBLISHED date later than the SIG_DATE attribute in <code class="highlighter-rouge">proof.json</code></li>
  <li>If the <code class="highlighter-rouge">pub_key</code> is revoked in the DCP entry for the NOTARY, it MUST NOT be revoked before the value of SIG_DATE attribute in <code class="highlighter-rouge">proof.json</code></li>
</ul>

<p>If, using NOTARY identifier and the DCL/DCP mechanism, the <code class="highlighter-rouge">pub_key</code> can not be shown to be valid (non-revoked) public key of the notary on SIG_DATE, then <code class="highlighter-rouge">proof.json</code> is not valid.</p>

<p>If the public key is valid (and saved as <code class="highlighter-rouge">notary_pub.key</code>), you may import it to the GnuPG program like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>gpg2 --import notary_pub.key
</code></pre>
</div>

<p>If the public key is valid, the next step is to confirm that <code class="highlighter-rouge">proof.sig</code> is in fact a digital signature of <code class="highlighter-rouge">proof.json</code> which was made with the private key corresponding to the <code class="highlighter-rouge">pub_key</code> attribute of <code class="highlighter-rouge">proof.json</code>.</p>

<p>Assuming you have imported the verified valid key into the GnuPG program, and have <code class="highlighter-rouge">proof.json</code> and <code class="highlighter-rouge">proof.sig</code> in your present working directory, you can confirm the signature like this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>gpg2 --verify proof.sig proof.json
</code></pre>
</div>

<p>After verifying proof.json with proof.sig, it is safe to process the HOC Header.</p>

<h2 id="hoc-header">HOC Header</h2>

<p>The HOC Header is processed after the HOC Proof has been validated. It is essentially an arbitrarily long list of references to HOC Detail records. It also contains metadata about access and availability of HOC Detail records.</p>

<ul>
  <li>The HOC Archive proof.json file MUST contain reference to (content-address of) single HOC Header</li>
  <li>the HOC Header MUST be available by <code class="highlighter-rouge">/private/{content_hash}</code> or <code class="highlighter-rouge">/public/{content_hash}</code> endpoint</li>
  <li>The contents of the <code class="highlighter-rouge">hoc_head</code> file MUST be json that is valid per <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/hoc_head.schema"><code class="highlighter-rouge">hoc_head.schema</code></a> JSON schema</li>
  <li><code class="highlighter-rouge">hoc_head</code> MUST contain a list of one or more elements.</li>
  <li>Each element in <code class="highlighter-rouge">hoc_head</code> list MUST contain a <code class="highlighter-rouge">hoc_detail</code> attribute, which is a valid content-address of a json file.</li>
  <li>Each element in <code class="highlighter-rouge">hoc_head</code> list MUST contain a <code class="highlighter-rouge">durability</code> attribute.</li>
  <li>The value of <code class="highlighter-rouge">durability</code> attribute MUST be an ISO 8601 formatted string describing the date and time with timezone until which the HOC Detail is promised available.</li>
  <li>Each element in <code class="highlighter-rouge">hoc_head</code> list MUST contain a <code class="highlighter-rouge">network</code> attribute.</li>
  <li>The value of <code class="highlighter-rouge">network</code> attribute MUST be a valid business identifier URN per the DCP and DCL specifications.</li>
  <li>Each element in <code class="highlighter-rouge">hoc_head</code> list MUST contain an <code class="highlighter-rouge">ac_code</code> attribute.</li>
  <li>The HOC Header MUST be available directly with its content-address (e.g. <code class="highlighter-rouge">/ipfs/Qmcov9Bx5SiAT281UmCQUCyGUKU2VFYYSK31XqXq8S8edu</code>).</li>
  <li>The HOC Header MAY be published with its content-address as its name within the directory-like collection that was gazetted to the blockchain (e.g. <code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2/Qmcov9Bx5SiAT281UmCQUCyGUKU2VFYYSK31XqXq8S8edu</code>).</li>
</ul>

<p>IPFS note: if you follow last item (publish HOC Header indirectly, as a part of the HOC Archive) then previous one (direct accessibility) will be fulfilled automatically.</p>

<p>The <code class="highlighter-rouge">ac_code</code> partially defines the protocol for accessing the record referenced in the <code class="highlighter-rouge">hoc_detail</code> attribute. The meaning of the <code class="highlighter-rouge">ac_code</code> is dependent on the <code class="highlighter-rouge">network</code>. In other words, the <code class="highlighter-rouge">ac_code</code> is interpreted in the context of the <code class="highlighter-rouge">network</code>.</p>

<p>Because the network is a business identifier URN, the <code class="highlighter-rouge">ac_code</code> interpretation context can be determined by DCP query.</p>

<p>If the <code class="highlighter-rouge">network</code> is the URN of the notary, the DCP lookup of <code class="highlighter-rouge">RECORD_ACCESS_PROTOCOL</code> MUST return <code class="highlighter-rouge">ausdigital-nry/1</code> or higher version. Otherwise they can be anything (including undefined).</p>

<p>If the DCP document type / process type of the <code class="highlighter-rouge">hoc_header</code> list item’s <code class="highlighter-rouge">network</code> is <code class="highlighter-rouge">ausdigital-nry/1</code>, then the allowable value of <code class="highlighter-rouge">ac_code</code> are:</p>

<table>
  <thead>
    <tr>
      <th>Access Protocol</th>
      <th><code class="highlighter-rouge">ac_code</code></th>
      <th>HOC Detail</th>
      <th>Notarised Object</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ausdigital-nry/1</td>
      <td>0</td>
      <td>Public</td>
      <td>Public</td>
      <td>Transparently auditable open data (e.g. public HOC documents).</td>
    </tr>
    <tr>
      <td>ausdigital-nry/1</td>
      <td>1</td>
      <td>Public</td>
      <td>Private</td>
      <td>Independently auditable secret data (e.g. business transaction records, such as eInvoices).</td>
    </tr>
    <tr>
      <td>ausdigital-nry/1</td>
      <td>2</td>
      <td>Private</td>
      <td>Public</td>
      <td>Plausibly deniable open data (that can be subsequently rendered transparently auditable by publishing the HOC Detail).</td>
    </tr>
    <tr>
      <td>ausdigital-nry/1</td>
      <td>3</td>
      <td>Private</td>
      <td>Private</td>
      <td>Privately auditable secret data (e.g. Corporate records).</td>
    </tr>
    <tr>
      <td>[other]</td>
      <td>[any]</td>
      <td>[either]</td>
      <td>[either]</td>
      <td>If Access Protocol is not <code class="highlighter-rouge">ausdital-nry/1</code> (or later), arbitrary (locally meaningful) <code class="highlighter-rouge">ac_code</code> may be used.</td>
    </tr>
  </tbody>
</table>

<h3 id="validating-hoc-header">Validating HOC Header</h3>

<p>note: this can be cached: when processing a HOC Header, the value of DCP lookups MAY be assumed not to change between <code class="highlighter-rouge">hoc_header</code> list items.</p>

<p>For each <code class="highlighter-rouge">hoc_header</code> list item:</p>

<ul>
  <li>If the <code class="highlighter-rouge">network</code> is not equal to the <code class="highlighter-rouge">proof.json</code> NOTARY, and if DCP lookup of <code class="highlighter-rouge">RECORD_ACCESS_PROTOCOL</code> for the <code class="highlighter-rouge">network</code> does not resolve to <code class="highlighter-rouge">ausdigital-nry/1</code>, then this specification does not describe how to validate that <code class="highlighter-rouge">hoc_detail</code> record. Refer to the appropriate protocol specification for interpretation of <code class="highlighter-rouge">ac_code</code> values in that context. Do not proceed with validating the listed HOC Header or any HOC Details it seems to refer to (even if the syntax seems identicaly compatabled with <code class="highlighter-rouge">ausdigital-nry/1</code> protocol).</li>
</ul>

<p>If the <code class="highlighter-rouge">network</code> is equal to the <code class="highlighter-rouge">proof.json</code> NOTARY, or if the DCL lookup of <code class="highlighter-rouge">RECORD_ACCESS_PROTOCOL</code> for the <code class="highlighter-rouge">network</code> resolves to <code class="highlighter-rouge">ausdigital-nry/1</code>, then apply the following validation rules:</p>

<p>If <code class="highlighter-rouge">ac_code</code> is 0 or 1:</p>

<ul>
  <li>If the <code class="highlighter-rouge">hoc_header</code> item <code class="highlighter-rouge">durability</code> is a future date, the content-address of the <code class="highlighter-rouge">hoc_detail</code> object MUST be directly available (for example <code class="highlighter-rouge">/ipfs/Qmcov9Bx5SiAT281UmCQUCyGUKU2VFYYSK31XqXq8S8edu</code></li>
  <li>If the <code class="highlighter-rouge">hoc_header</code> item <code class="highlighter-rouge">durability</code> is a future date, and the <code class="highlighter-rouge">proof.json</code> <code class="highlighter-rouge">durability</code> is also a future date, the content address MAY be available within the directory-like container of the Full HOC (for example <code class="highlighter-rouge">/ipfs/QmS5EogHn2MtSBsQ4wXFEPeiA1zWPfaEbumWEJJNsUWuW2/Qmcov9Bx5SiAT281UmCQUCyGUKU2VFYYSK31XqXq8S8edu</code>)</li>
</ul>

<p>If <code class="highlighter-rouge">ac_code</code> is 2 or 3:</p>

<ul>
  <li>If the <code class="highlighter-rouge">hoc_header</code> item <code class="highlighter-rouge">durability</code> is a future date, and the JWT Token has valid identity claim, the content-address MAY be available via the notary API (<code class="highlighter-rouge">GET /private/{content_address}</code>).</li>
  <li>If the <code class="highlighter-rouge">hoc_header</code> item <code class="highlighter-rouge">durability</code> is a future date, and the JWT Token has valid identity claim, and the JWT Token identity claim matches the <code class="highlighter-rouge">proof.json</code> NOTARY, the content-address MUST be available via the notary API (<code class="highlighter-rouge">GET /private/{content_address}/</code>).
 To the business identity of the <code class="highlighter-rouge">network</code>, the content-address MUST be available via the notary API (<code class="highlighter-rouge">GET /private/{content_address}</code>).</li>
</ul>

<p>When notarised objects are submitted to the notary API with <code class="highlighter-rouge">ac_code</code> referring to private objects (see table) (e.g. <code class="highlighter-rouge">ac_code &gt; 0</code>), the <code class="highlighter-rouge">restrict_list</code> parameter contains a list of business identifiers permitted to access the object. This restrict_list lists the business identifiers of all parties with rights to access the record.</p>

<p><code class="highlighter-rouge">restrict_list</code> only applies to private objects (see ac_code table above, items where HocDetail or notarized document is private).</p>

<p>For any object:</p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td>item MUST be available as /public</td>
          <td>private/{content_address} before durability date</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>item MAY be available as /public</td>
          <td>private/{content_address} after durability date</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p>If object is private:</p>

<ul>
  <li>item MUST be available only to client with valid JWT token with valid identity claim and this identity claim can be found in target object restrict_list</li>
  <li>item MUST NOT be available for any other client (but other item with different restrictions but same doc_id may be available in its place)</li>
  <li>item MUST NOT be available as /public/{content_address}/ for any other user</li>
  <li>item MUST NOT be published to public IPFS or any other network by this notarizer (3rd party still can do it if it has access to it)</li>
</ul>

<p><strong>TODO</strong>: cross reference API spec (request notarisation on the API)</p>

<p><strong>TODO</strong>: ensure API spec includes <code class="highlighter-rouge">ac_code</code> parameter (validate if /private/ <code class="highlighter-rouge">ac_code</code> in (2,3), if /public/ <code class="highlighter-rouge">ac_code</code> in (0,1), if <code class="highlighter-rouge">ac_code==0</code> <code class="highlighter-rouge">restrict_list</code> empty (no restrictions), if <code class="highlighter-rouge">ac_code!=0</code> <code class="highlighter-rouge">restrict_list</code> must not be empty).</p>

<h3 id="notary-reputation">Notary Reputation</h3>

<p>Once a <code class="highlighter-rouge">proof.json</code> has been validated, the availability (or otherwise) of the HOC Header, within the timeframe of <code class="highlighter-rouge">proof.json</code> durability, this MAY be considered to impact the objective reputation of the Notary.</p>

<p>The availability or otherwise of HOC Headers may or may not be directly related to the objective global reputation of the Notary.</p>

<ul>
  <li>If the <code class="highlighter-rouge">hoc_head.network</code> is a URN of the same business as the <code class="highlighter-rouge">proof.json</code> NOTARY, and if the <code class="highlighter-rouge">RECORD_ACCESS_PROTOCOL</code> of that business (DCP lookup) is not <code class="highlighter-rouge">ausdigital-nry/1</code> (or later version), then the notary has absconded their responsibility. This MAY have a strongly negative impact on the reputation of the notary.</li>
  <li>If the <code class="highlighter-rouge">hoc_head.network</code> is a URN of a different business as the <code class="highlighter-rouge">proof.json</code> NOTARY, the availability or otherwise of <code class="highlighter-rouge">hoc_detail</code> (and notarised objects) MUST NOT be interpreted as impacting the reputation of either business.</li>
  <li>The <code class="highlighter-rouge">durability</code> date/time represents the limit of promised availability of the notarised object.</li>
  <li>If the <code class="highlighter-rouge">hoc_detail</code> <code class="highlighter-rouge">network</code> is the same business as NOTARY, that means the Notary is taking responsibility for the promise of availability. Failure to meet terms of <code class="highlighter-rouge">ac_code</code> and <code class="highlighter-rouge">durability</code> will detrimentally impact the reputation of the Notary.</li>
</ul>

<p>If the <code class="highlighter-rouge">hoc_head.network</code> identifies a business other than the <code class="highlighter-rouge">proof.json</code> NOTARY, the <code class="highlighter-rouge">durability</code> and <code class="highlighter-rouge">ac_code</code> represent claims (by the notary) about promises made by another business. The reason these MUST NOT be interpreted as impacting the objective reputation of either party is that it is impossible to distinguish false claims from true claims and broken promises.</p>

<p>In addition to global objective notary reputation (which can be based on transparently auditable open data), organisations with privileged access to the notary API (through RESTRICTION_LIST privileges to <code class="highlighter-rouge">ac_code</code> “1”, “2” and “3” notarised objects and <code class="highlighter-rouge">ac_code</code> “2” and “3” <code class="highlighter-rouge">hoc_detail</code> records) may produce private objective reputation scores.</p>

<h2 id="hoc-detail">HOC Detail</h2>

<p>The HOC Detail is a JSON document of arbitrary size, referenced by its content-address in the HOC Header list or from another HOC Detail.</p>

<ul>
  <li>The HOC Detail MUST inherit <code class="highlighter-rouge">ac_code</code> and <code class="highlighter-rouge">network</code> attributes from the reference to this HOC Detail</li>
  <li>The HOC Detail MUST contain a list of one or more elements.</li>
  <li>The HOC Detail MUST be validated against the <a href="https://github.com/ausdigital/ausdigital-nry/blob/master/resources/1.0/spec/hoc_detail.schema"><code class="highlighter-rouge">hoc_detail.schema</code></a> JSON schema.</li>
</ul>

<p>The elements in any given HOC Detail inherit an <code class="highlighter-rouge">ac_code</code> and <code class="highlighter-rouge">network</code> from this HOC Detail, and HOC Detail receives these values from reference to it (from HOC Header for top-level HOC Detail or from parent HOC Detail for nested).
Every element in the HOC Detail list MUST reference either individual notarized document OR nested HOC Detail.</p>

<p>In any case, HOC Detail row:</p>

<ul>
  <li>MUST contain a <code class="highlighter-rouge">durability</code> attribute, which contains an ISO 8601 formatted date string.</li>
  <li>The <code class="highlighter-rouge">durability</code> date MUST NOT be less than one month ahead of the <code class="highlighter-rouge">proof.json</code> SIG_DATE attribute.</li>
  <li>The <code class="highlighter-rouge">durability</code> date MUST NOT be more than the corresponding <code class="highlighter-rouge">hoc_header</code> durability date.</li>
</ul>

<p>If reference to a notarized object, HOC Detail row:</p>
<ul>
  <li>MUST contain an <code class="highlighter-rouge">object</code> attribute, which contains a content-address of some notarised object.</li>
  <li>MUST assume that given object inherits <code class="highlighter-rouge">network</code> and <code class="highlighter-rouge">ac_code</code> from this HOC Detail</li>
</ul>

<p>If reference to a nested HOC Detail, referencing HOC Detail row:</p>

<ul>
  <li>MUST contain <code class="highlighter-rouge">hoc_detail</code> attribute with valid content-hash of referenced HOC Detail</li>
  <li>MUST assume that referenced HOC Detail receives the same <code class="highlighter-rouge">ac_code</code> and <code class="highlighter-rouge">network</code> as this referencing HOC Detail</li>
  <li>MAY ommit <code class="highlighter-rouge">ac_code</code> and <code class="highlighter-rouge">network</code> parameters (because they are equal to top-level).</li>
  <li>client MAY recursive follow referenced HOC Detail if client interested in data in it (and have access)</li>
</ul>

<p>HOC Detail <code class="highlighter-rouge">restrict_list</code>:</p>

<ul>
  <li>MUST not affect it’s availability if HOC Detail is public</li>
  <li>MUST limit access if HOC Detail is private</li>
  <li>MUST contain any item from any referenced element (either netsted HOC Detail or notarized object)</li>
</ul>

<p>Example of HOC Detail, which references objects and nested Hoc Details:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>```
[
  {
      "object": "QmNotarizedObject001ContentAddress",
      "durability": "2018-03-10T00:00:00+00:00"
  },
  {
      "object": "QmAnotherNotarizedObjectContentAddress",
      "durability": "2018-03-10T00:00:00+00:00"
  },
  {
    "hoc_detail": "QmNestedHocHeaderContentAddress",
    "durability": "2019-03-10T00:00:00+00:00"
  },
  ....
]
```
</code></pre>
</div>

<p>If given HOC Detail example is referenced with <code class="highlighter-rouge">ac_code = X</code> and <code class="highlighter-rouge">network = "urn:XXXX"</code> then any item here (QmNotarizedObject001ContentAddress, QmAnotherNotarizedObjectContentAddress, QmNestedHocHeaderContentAddress) inherit it. See real-world examples from nry.testpoint.io for more information.</p>

<p>If the <code class="highlighter-rouge">ac_code</code> says that notarized object public then notarized object MUST be available as <code class="highlighter-rouge">/public/{content_address}</code>
If the <code class="highlighter-rouge">ac_code</code> says that notarized object private then notarized object MUST be available as <code class="highlighter-rouge">/private/{content_address}</code> to capable users (see “Validating HOC Header” section for details about private/public objects).
Same is applicable for HocDetail object.</p>

<p># Related Material</p>

<ul>
  <li><a href="https://github.com/ausdigital/ausdigital-nry/issues/">GitHub issues</a> for collaborating on the development of the NRY.</li>
  <li>A reference <a href="http://testpoint.io/nry">NRY service</a> (for testing and development purposes).</li>
  <li>Free, Open-Source Software <a href="https://github.com/test-point/testpoint-nry">NRY implementation</a>.</li>
  <li>An automated <a href="https://github.com/test-point/testpoint-nry">NRY test suite</a>.</li>
</ul>

        </div>
    </div>
</div>
<footer class="footer">
    <a href="/" class="footer-logo"><img src="/images/logo.png" alt="AusDigital"><span>AusDigital.org</span></a>
    <ul class="footer-menu">
        <li><a href="http://ausdigital.org/about">About AusDigital</a></li>
        <li><a href="https://github.com/ausdigital" target="_blank">Github</a></li>
        <li><a href="http://eepurl.com/ctZ6hf" target="_blank">Newsletter</a></li>
        <li><a href="http://chat.ausdigital.org/" target="_blank">Join</a> <a href="https://ausdigital.slack.com/messages/general/" target="_blank">team</a></li>
    </ul>
    <div class="footer-credits">
        This page was generated by GitHub Pages.
        Comments, issues and suggestions are welcome in the <a href="https://github.com/ausdigital/ausdigital.github.io/issues/new">ticket system</a>.
        Pull requests welcome in the <a href="https://github.com/ausdigital/ausdigital.github.io/">site repository</a>.
    </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79579364-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>